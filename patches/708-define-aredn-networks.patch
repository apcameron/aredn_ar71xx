Index: openwrt/package/base-files/files/lib/functions/uci-defaults.sh
===================================================================
--- openwrt.orig/package/base-files/files/lib/functions/uci-defaults.sh
+++ openwrt/package/base-files/files/lib/functions/uci-defaults.sh
@@ -162,7 +162,7 @@ _ucidef_finish_switch_roles() {
 
 				if [ ${need_tag:-0} -eq 1 -o ${want_untag:-0} -ne 1 ]; then
 					num="${num}t"
-					device="${device}.${index}"
+					device="${device}.$((index - 1))"
 				fi
 
 				json_select roles
Index: openwrt/package/base-files/files/bin/config_generate
===================================================================
--- openwrt.orig/package/base-files/files/bin/config_generate
+++ openwrt/package/base-files/files/bin/config_generate
@@ -151,10 +151,11 @@ generate_switch_vlans_ports() {
 				json_get_vars ports
 			json_select ..
 
+			vlan_num=$((role - 1))
 			uci -q batch <<-EOF
 				add network switch_vlan
 				set network.@switch_vlan[-1].device='$switch'
-				set network.@switch_vlan[-1].vlan='$role'
+				set network.@switch_vlan[-1].vlan='$vlan_num'
 				set network.@switch_vlan[-1].ports='$ports'
 			EOF
 		done

--- openwrt.orig/target/linux/ath79/base-files/etc/board.d/02_network
+++ openwrt/target/linux/ath79/base-files/etc/board.d/02_network
@@ -31,7 +32,9 @@ ath79_setup_interfaces()
 	ubnt,unifi|\
 	wd,mynet-wifi-rangeextender|\
 	winchannel,wb2000)
-		ucidef_set_interface_lan "eth0"
+		ucidef_set_interfaces_lan_wan "eth0" "eth0.1"
+		ucidef_set_interface "wifi" ifname "wlan0" protocol "static"
+		ucidef_set_interface "dtdlink" ifname "eth0.2" protocol "static"
 		;;
 	avm,fritz4020|\
 	tplink,archer-c58-v1|\
@@ -130,9 +133,10 @@ ath79_setup_interfaces()
 	tplink,tl-mr3420-v1|\
 	tplink,tl-wr841-v7|\
 	ubnt,airrouter)
-		ucidef_set_interface_wan "eth0"
+		ucidef_set_interface_wan "eth1"
+		ucidef_set_interface "wifi" ifname "wlan0" protocol "static"
 		ucidef_add_switch "switch0" \
-			"0@eth1" "1:lan:4" "2:lan:3" "3:lan:2" "4:lan:1"
+			"0@eth0" "4:lan:1" "3:lan:2" "2:lan:3" "1t:unused" "1t:dtdlink"
 		;;
 	tplink,archer-a7-v5|\
 	tplink,tl-wdr3600|\
@@ -199,7 +203,9 @@ ath79_setup_interfaces()
 			"0@eth0" "2:lan" "3:wan"
 		;;
 	*)
-		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_set_interface "wifi" ifname "wlan0" protocol "static"
+		ucidef_set_interfaces_lan_wan "eth0" "eth0.1"
+		ucidef_set_interface "dtdlink" ifname "eth0.2" protocol "static"
 		;;
 	esac
 }
